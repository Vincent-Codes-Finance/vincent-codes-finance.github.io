<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Vincent Grégoire, PhD, CFA">
<meta name="dcterms.date" content="2024-01-31">
<meta name="description" content="Tutorial on estimating standard errors in time series data with Python and statsmodels">

<title>Vincent Codes Finance - Estimating standard errors in time series data with Python and statsmodels</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-XG6JSNQZJK"></script>

<script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-XG6JSNQZJK', { 'anonymize_ip': true});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="Vincent Codes Finance - Estimating standard errors in time series data with Python and statsmodels">
<meta property="og:description" content="A blog about coding (mostly) in Python for empirical research in finance">
<meta property="og:image" content="https://vincent.codes.finance/posts/timeseries-standard-errors/spy_ts.webp">
<meta property="og:site_name" content="Vincent Codes Finance">
<meta property="og:locale" content="en_US">
<meta name="twitter:title" content="Vincent Codes Finance - Estimating standard errors in time series data with Python and statsmodels">
<meta name="twitter:description" content="A blog about coding (mostly) in Python for empirical research in finance">
<meta name="twitter:image" content="https://vincent.codes.finance/posts/timeseries-standard-errors/spy_ts.webp">
<meta name="twitter:card" content="summary_large_image">
<link rel="canonical" href="https://vincent.codes.finance/posts/timeseries-standard-errors/" />
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../vcf-logo-small.webp" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Vincent Codes Finance</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-python-tutorials" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Python tutorials</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-python-tutorials">    
        <li>
    <a class="dropdown-item" href="../../posts/install-python-312/index.html">
 <span class="dropdown-text">Install Python 3.12</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../intro-to-python/python-basics/index.html">
 <span class="dropdown-text">Python basics</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About VCF</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Vincent-Codes-Finance"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.youtube.com/channel/UCuNrwdpvF1LBGJ2cNL5b68w"> <i class="bi bi-youtube" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/CodesFinance"> <i class="bi bi-twitter-x" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.threads.net/@codesfinance"> <i class="bi bi-threads" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/company/vincent-codes-finance/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.facebook.com/profile.php?id=61559283113665"> <i class="bi bi-facebook" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Estimating standard errors in time series data with Python and statsmodels</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Python</div>
                <div class="quarto-category">Econometrics</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Vincent Grégoire, PhD, CFA </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 31, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar"><div class="quarto-margin-header"><div class="margin-header-item">

<!--Zoho Campaigns Web-Optin Form's Header Code Starts Here-->

<script type="text/javascript" src="https://zmp-glf.maillist-manage.com/js/optin.min.js" onload="setupSF('sf3zebf6c0313d0ddfd85656d496c903350205cbbde44a7d630868cbe868c84c5a8a','ZCFORMVIEW',false,'light',false,'0')"></script>
<script type="text/javascript">
    function runOnFormSubmit_sf3zebf6c0313d0ddfd85656d496c903350205cbbde44a7d630868cbe868c84c5a8a(th){
        /*Before submit, if you want to trigger your event, "include your code here"*/
    };
</script>

<style>
.quick_form_8_css * {
    -webkit-box-sizing: border-box !important;
    -moz-box-sizing: border-box !important;
    box-sizing: border-box !important;
    overflow-wrap: break-word
}
@media only screen and (max-width: 600px) {.quick_form_8_css[name="SIGNUP_BODY"] { width: 100% !important; min-width: 100% !important; margin: 0px auto !important; padding: 0px !important } .SIGNUP_FLD { width: 90% !important; margin: 10px 5% !important; padding: 0px !important } .SIGNUP_FLD input { margin: 0 !important; border-radius: 25px !important } }
</style>

<!--Zoho Campaigns Web-Optin Form's Header Code Ends Here--><!--Zoho Campaigns Web-Optin Form Starts Here-->

<div id="sf3zebf6c0313d0ddfd85656d496c903350205cbbde44a7d630868cbe868c84c5a8a" data-type="signupform" style="opacity: 1;">
    <div id="customForm">
        <div class="quick_form_8_css" style=" z-index: 2; border-width: 1px; border-style: solid; border-color: #b4befe; overflow: hidden; width: 208px" name="SIGNUP_BODY">
            <div>
                <div style="font-size: 14px; font-weight: bold; text-align: left; padding: 10px 20px 5px; display: block; height: 20px; width: 293px;" id="SIGNUP_HEADING">Subscribe to newsletter</div>
                <div style="position:relative;">
                    <div id="Zc_SignupSuccess" style="display:none;position:absolute;margin-left:4%;width:90%;background-color: white; padding: 3px; border: 3px solid rgb(194, 225, 154);  margin-top: 10px;margin-bottom:10px;word-break:break-all">
                        
<table class="caption-top table" data-quarto-postprocess="true" width="100%" data-cellpadding="0" data-cellspacing="0" data-border="0">
<tbody>
<tr class="odd">
<td width="10%"><img src="https://zmp-glf.maillist-manage.com/images/challangeiconenable.jpg" class="successicon img-fluid" data-align="absmiddle"></td>
<td><span id="signupSuccessMsg" style="color: rgb(73, 140, 132); font-size: 14px;word-break:break-word">&nbsp;&nbsp;Thank you for Signing Up</span></td>
</tr>
</tbody>
</table>

                    </div>
                </div>
                <form method="POST" id="zcampaignOptinForm" style="margin: 0px; width: 100%" action="https://zmp-glf.maillist-manage.com/weboptin.zc" target="_zcSignup">
                    <div style="background-color: rgb(255, 235, 232); padding: 10px; color: rgb(210, 0, 0); font-size: 11px; margin: 20px 10px 0px; border: 1px solid rgb(255, 217, 211); opacity: 1; display: none" id="errorMsgDiv">Invalid email.</div>
                    <div style="position: relative; margin: 10px; height: 30px; display: inline-block; width: 185px" class="SIGNUP_FLD">
                        <input type="text" style="border: 1px solid rgb(221, 221, 221); border-radius: 0px; width: 100%; height: 100%; z-index: 4; outline: none; padding: 5px 10px; color: rgb(136, 136, 136); text-align: left; background-color: rgb(255, 255, 255); box-sizing: border-box; font-size: 11px" placeholder="Email" changeitem="SIGNUP_FORM_FIELD" name="CONTACT_EMAIL" id="EMBED_FORM_EMAIL_LABEL">
                    </div>
                    <div style="position: relative; margin: 10px; width: 100px; height: 30px; text-align: left; display: inline-block" class="SIGNUP_FLD">
                        <input type="button" style="text-align: center; border-radius: 5px; width: 100%; height: 100%; z-index: 5; border: 0px; color: rgb(255, 255, 255); cursor: pointer; outline: none; font-size: 14px; background-color: #fab387; margin: 0px 0px 0px -5px" name="SIGNUP_SUBMIT_BUTTON" id="zcWebOptin" value="Subscribe">
                    </div>
                    <input type="hidden" id="fieldBorder" value="">
                    <input type="hidden" id="submitType" name="submitType" value="optinCustomView">
                    <input type="hidden" id="emailReportId" name="emailReportId" value="">
                    <input type="hidden" id="formType" name="formType" value="QuickForm">
                    <input type="hidden" name="zx" id="cmpZuid" value="132186a6c">
                    <input type="hidden" name="zcvers" value="3.0">
                    <input type="hidden" name="oldListIds" id="allCheckedListIds" value="">
                    <input type="hidden" id="mode" name="mode" value="OptinCreateView">
                    <input type="hidden" id="zcld" name="zcld" value="1109faaf6213b38dc">
                    <input type="hidden" id="zctd" name="zctd" value="1109faaf6213b37a9">
                    <input type="hidden" id="document_domain" value="">
                    <input type="hidden" id="zc_Url" value="zmp-glf.maillist-manage.com">
                    <input type="hidden" id="new_optin_response_in" value="0">
                    <input type="hidden" id="duplicate_optin_response_in" value="0">
                    <input type="hidden" name="zc_trackCode" id="zc_trackCode" value="ZCFORMVIEW">
                    <input type="hidden" id="zc_formIx" name="zc_formIx" value="3zebf6c0313d0ddfd85656d496c903350205cbbde44a7d630868cbe868c84c5a8a">
                    <input type="hidden" id="viewFrom" value="URL_ACTION">
                    <span style="display: none" id="dt_CONTACT_EMAIL">1,true,6,Contact Email,2</span>
                </form>
            </div>
        </div>
    </div>
    <img src="https://zmp-glf.maillist-manage.com/images/spacer.gif" id="refImage" onload="referenceSetter(this)" style="display:none;">
</div>
<input type="hidden" id="signupFormType" value="QuickForm_Horizontal">
<div id="zcOptinOverLay" oncontextmenu="return false" style="display:none;text-align: center; background-color: rgb(0, 0, 0); opacity: 0.5; z-index: 100; position: fixed; width: 100%; top: 0px; left: 0px; height: 988px;"></div>
<div id="zcOptinSuccessPopup" style="display:none;z-index: 9999;width: 800px; height: 40%;top: 84px;position: fixed; left: 26%;background-color: #FFFFFF;border-color: #E6E6E6; border-style: solid; border-width: 1px;  box-shadow: 0 1px 10px #424242;padding: 35px;">
    <span style="position: absolute;top: -16px;right:-14px;z-index:99999;cursor: pointer;" id="closeSuccess">
        <img src="https://zmp-glf.maillist-manage.com/images/videoclose.png">
    </span>
    <div id="zcOptinSuccessPanel"></div>
</div>

<!--Zoho Campaigns Web-Optin Form Ends Here-->

<div style="padding: 15px 0px"><script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="codesfinance" data-color="#FFDD00" data-emoji="☕" data-font="Cookie" data-text="Buy me a coffee" data-outline-color="#000000" data-font-color="#000000" data-coffee-color="#ffffff"></script></div>

</div></div>
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#video-tutorial" id="toc-video-tutorial" class="nav-link active" data-scroll-target="#video-tutorial">Video tutorial</a></li>
  <li><a href="#time-series-data" id="toc-time-series-data" class="nav-link" data-scroll-target="#time-series-data">Time series data</a></li>
  <li><a href="#test-data" id="toc-test-data" class="nav-link" data-scroll-target="#test-data">Test data</a></li>
  <li><a href="#statsmodels" id="toc-statsmodels" class="nav-link" data-scroll-target="#statsmodels">statsmodels</a>
  <ul class="collapse">
  <li><a href="#installation" id="toc-installation" class="nav-link" data-scroll-target="#installation">Installation</a></li>
  <li><a href="#usage" id="toc-usage" class="nav-link" data-scroll-target="#usage">Usage</a></li>
  </ul></li>
  <li><a href="#ols-coefficients-and-standard-errors" id="toc-ols-coefficients-and-standard-errors" class="nav-link" data-scroll-target="#ols-coefficients-and-standard-errors">OLS coefficients and standard errors</a></li>
  <li><a href="#white-standard-errors" id="toc-white-standard-errors" class="nav-link" data-scroll-target="#white-standard-errors">White standard errors</a></li>
  <li><a href="#newey-west-standard-errors" id="toc-newey-west-standard-errors" class="nav-link" data-scroll-target="#newey-west-standard-errors">Newey-West standard errors</a></li>
  <li><a href="#cheat-sheet" id="toc-cheat-sheet" class="nav-link" data-scroll-target="#cheat-sheet">Cheat sheet</a></li>
  <li><a href="#learn-more" id="toc-learn-more" class="nav-link" data-scroll-target="#learn-more">Learn more</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>In this post, I show how to estimate standard errors in OLS regressions of time series data with Python and the <a href="https://www.statsmodels.org/stable/index.html">statsmodels</a> library.</p>
<p>More specifically, I show how to estimate OLS models with:</p>
<ul>
<li><a href="#ols-coefficients-and-standard-errors">OLS (non-robust) standard errors</a></li>
<li><a href="#white-standard-errors">White (heteroskedasticity-robust) standard errors</a></li>
<li><a href="#newey-west-standard-errors">Newey-West standard errors</a></li>
</ul>
<p>If you just want the code examples with no explanations, jump to the <a href="#cheat-sheet">cheat sheet</a> at the end of the post.</p>
<p>For panel data models, see my previous post on <a href="../../posts/panel-ols-standard-errors/index.html">estimating standard errors in panel data models with Python and linearmodels</a>.</p>
<section id="video-tutorial" class="level2">
<h2 class="anchored" data-anchor-id="video-tutorial">Video tutorial</h2>
<p>Part of this post is also available as a video tutorial on YouTube.</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/Rq3lEPKvKKo" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</section>
<section id="time-series-data" class="level2">
<h2 class="anchored" data-anchor-id="time-series-data">Time series data</h2>
<p>Time series data is ubiquitous in finance research, but it can present challenges when using it in OLS regressions because it can violate the assumptions of OLS. The main challenge is that the error term can be correlated across time periods and can be heteroskedastic, meaning that the variance of the error term is not constant. This can lead to biased standard errors and invalid hypothesis tests. Time series data models have the following form:</p>
<p><span class="math display">\[
y_{t} =  x_{t}\beta  + \epsilon_{t},
\]</span></p>
<p>where <span class="math inline">\(y_{t}\)</span> is the dependent variable at time <span class="math inline">\(t\in [1,T]\)</span>, <span class="math inline">\(x_{t}\)</span> is a vector of independent variables, <span class="math inline">\(\beta\)</span> is a vector of coefficients, and <span class="math inline">\(\epsilon_{t}\)</span> is the error term. If the model includes an intercept, then the first element of <span class="math inline">\(x_{t}\)</span> is <code>1</code> and the first element of <span class="math inline">\(\beta\)</span> is <span class="math inline">\(\alpha\)</span>.</p>
<p>When we get to the data, we write the model in matrix form:</p>
<p><span class="math display">\[
\mathbf{y} = \mathbf{X}\beta + \mathbf{\epsilon},
\]</span></p>
<p>where <span class="math inline">\(\mathbf{y}\)</span> is a <span class="math inline">\(T \times 1\)</span> vector of dependent variables, <span class="math inline">\(\mathbf{X}\)</span> is a <span class="math inline">\(T \times K\)</span> matrix of independent variables, <span class="math inline">\(\beta\)</span> is a <span class="math inline">\(K \times 1\)</span> vector of coefficients, and <span class="math inline">\(\mathbf{\epsilon}\)</span> is a <span class="math inline">\(T \times 1\)</span> vector of error terms. The number of observations is <span class="math inline">\(T\)</span>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
More on matrix form representation
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The observations are then stacked in their temporal order. For example, the vector <span class="math inline">\(\mathbf{y}\)</span> of elements <span class="math inline">\(y_{t}\)</span> is defined as:</p>
<p><span class="math display">\[
\mathbf{y} = \left[\begin{array}{c} y_{1}\\ y_{2}\\ \vdots  \\  y_{T-1} \\ y_{T} \end{array} \right],
\]</span></p>
<p>The matrix <span class="math inline">\(\mathbf{X}\)</span> formed with vectors <span class="math inline">\(x_{t}\)</span> is defined as:</p>
<p><span class="math display">\[
\mathbf{X} = \left[\begin{array}{ccccc}
x_{1}^{(1)} &amp; x_{1}^{(2)} &amp; \cdots &amp; x_{1}^{(K-1)} &amp; x_{1}^{(K)} \\
x_{2}^{(1)} &amp; x_{2}^{(2)} &amp; \cdots &amp; x_{2}^{(K-1)} &amp; x_{2}^{(K)} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \vdots \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \vdots \\
x_{T-1}^{(1)} &amp; x_{T-1}^{(2)} &amp; \cdots &amp; x_{T-1}^{(K-1)} &amp; x_{T-1}^{(K)}\\
x_{T}^{(1)} &amp; x_{T}^{(2)} &amp; \cdots &amp; x_{T}^{(K-1)} &amp; x_{T}^{(K)}
\end{array} \right],
\]</span></p>
<p>where <span class="math inline">\(x_{t}^{(j)}\)</span> is the <span class="math inline">\(j\)</span>-th element of the vector <span class="math inline">\(x_{t}\)</span>.</p>
<p>Finally, the <span class="math inline">\(\beta\)</span> vector is defined as usual:</p>
<p><span class="math display">\[
\beta = \left[\begin{array}{c}\beta_1 \\ \beta_2 \\ \vdots \\ \beta_{K-1} \\ \beta_{K} \end{array} \right].
\]</span></p>
<p>If the model includes an intercept, then the first column of <span class="math inline">\(\mathbf{X}\)</span> is a column of ones (i.e.&nbsp;all the <span class="math inline">\(x_{t}^{(1)}\equiv 1\)</span>) and the first element of <span class="math inline">\(\beta\)</span> is <span class="math inline">\(\alpha\)</span>:</p>
<p><span class="math display">\[
\beta = \left[\begin{array}{c}\alpha \\ \beta_1 \\ \vdots \\ \beta_{K-2} \\ \beta_{K-1} \end{array} \right].
\]</span></p>
</div>
</div>
</div>
<p>The goal is then to estimate the coefficients <span class="math inline">\(\beta\)</span> and their associated standard errors. The standard errors are important because they allow us to perform statistical inference. In the context of financial anomalies, or more generally trading strategies, we can test whether the <span class="math inline">\(\alpha\)</span> is statistically different from zero.</p>
</section>
<section id="test-data" class="level2">
<h2 class="anchored" data-anchor-id="test-data">Test data</h2>
<p>In this post, I explain how to estimate standard errors in time series regressions with Python and the <a href="https://www.statsmodels.org/stable/index.html">statsmodels</a> library. I do so using the anomalies data set available on <a href="https://www.openassetpricing.com/">Open Source Asset Pricing</a>, which contains monthly returns for the anomalies discussed in <span class="citation" data-cites="ChenZimmermann2021">Chen and Zimmermann (<a href="#ref-ChenZimmermann2021" role="doc-biblioref">2022</a>)</span>. More specifically, I use daily returns of the 12-month momentum anomaly in the <code>PredictorVW.zip</code> file available at this <a href="https://drive.google.com/drive/folders/1I340N9Jwhvb2UKmcev84TfyqviIdPkrM">link</a>.</p>
<div id="cell-6" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"Mom12m_ret.csv"</span>, parse_dates<span class="op">=</span>[<span class="st">"date"</span>], index_col<span class="op">=</span>[<span class="st">"date"</span>])</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">port01</th>
<th data-quarto-table-cell-role="th">port02</th>
<th data-quarto-table-cell-role="th">port03</th>
<th data-quarto-table-cell-role="th">port04</th>
<th data-quarto-table-cell-role="th">port05</th>
<th data-quarto-table-cell-role="th">port06</th>
<th data-quarto-table-cell-role="th">port07</th>
<th data-quarto-table-cell-role="th">port08</th>
<th data-quarto-table-cell-role="th">port09</th>
<th data-quarto-table-cell-role="th">port10</th>
<th data-quarto-table-cell-role="th">portLS</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1927-01-03</td>
<td>-0.312789</td>
<td>-1.315867</td>
<td>-0.361545</td>
<td>-0.557918</td>
<td>-1.252321</td>
<td>-0.310728</td>
<td>-0.767765</td>
<td>-0.796250</td>
<td>-0.649846</td>
<td>-1.267020</td>
<td>-0.954230</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1927-01-04</td>
<td>1.845338</td>
<td>0.659064</td>
<td>0.828047</td>
<td>0.102919</td>
<td>0.213863</td>
<td>-0.011713</td>
<td>0.127618</td>
<td>0.102198</td>
<td>0.659057</td>
<td>0.874677</td>
<td>-0.970662</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1927-01-05</td>
<td>1.012461</td>
<td>0.724596</td>
<td>0.581067</td>
<td>-0.152049</td>
<td>0.079294</td>
<td>0.288886</td>
<td>0.283217</td>
<td>-0.080991</td>
<td>0.110790</td>
<td>0.048784</td>
<td>-0.963677</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1927-01-06</td>
<td>-0.902011</td>
<td>0.289840</td>
<td>-0.462931</td>
<td>-1.100983</td>
<td>-0.223404</td>
<td>-0.010662</td>
<td>-0.121442</td>
<td>-0.095102</td>
<td>-0.142538</td>
<td>-0.014550</td>
<td>0.887461</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1927-01-07</td>
<td>-0.332090</td>
<td>0.286702</td>
<td>0.062731</td>
<td>0.221905</td>
<td>0.152737</td>
<td>0.093068</td>
<td>0.456891</td>
<td>0.672505</td>
<td>0.225237</td>
<td>0.209930</td>
<td>0.542021</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022-12-23</td>
<td>-1.492861</td>
<td>-0.940321</td>
<td>-0.087377</td>
<td>0.254381</td>
<td>0.580743</td>
<td>0.502287</td>
<td>0.482743</td>
<td>0.588520</td>
<td>0.295648</td>
<td>1.433918</td>
<td>2.926779</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022-12-27</td>
<td>-3.014401</td>
<td>-3.667398</td>
<td>-1.638701</td>
<td>-0.776100</td>
<td>-0.984944</td>
<td>-0.153435</td>
<td>-0.000316</td>
<td>0.146955</td>
<td>-0.746434</td>
<td>0.281178</td>
<td>3.295579</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022-12-28</td>
<td>-0.475730</td>
<td>-1.287840</td>
<td>-0.931057</td>
<td>-1.367397</td>
<td>-1.121403</td>
<td>-1.162237</td>
<td>-1.097983</td>
<td>-0.922127</td>
<td>-1.433636</td>
<td>-1.478748</td>
<td>-1.003018</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022-12-29</td>
<td>6.153138</td>
<td>4.639327</td>
<td>3.960907</td>
<td>3.063374</td>
<td>2.489143</td>
<td>2.013535</td>
<td>1.798595</td>
<td>1.207053</td>
<td>1.708395</td>
<td>0.742981</td>
<td>-5.410157</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022-12-30</td>
<td>0.607938</td>
<td>0.718418</td>
<td>0.117090</td>
<td>-0.167288</td>
<td>-0.194521</td>
<td>-0.461471</td>
<td>-0.395566</td>
<td>-0.365650</td>
<td>-0.181250</td>
<td>-0.002331</td>
<td>-0.610269</td>
</tr>
</tbody>
</table>

<p>25249 rows × 11 columns</p>
</div>
</div>
</div>
<p>I complement the momentum strategy with the daily Fama-French 5 factors available from <a href="https://mba.tuck.dartmouth.edu/pages/faculty/ken.french/data_library.html">Ken French’s data library</a>.</p>
<div id="cell-8" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>ff5_df <span class="op">=</span> pd.read_csv(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://mba.tuck.dartmouth.edu/pages/faculty/ken.french/ftp/F-F_Research_Data_5_Factors_2x3_daily_CSV.zip"</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    skiprows<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    parse_dates<span class="op">=</span>[<span class="dv">0</span>],</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    index_col<span class="op">=</span>[<span class="dv">0</span>],</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean column names for formula api</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>ff5_df.columns <span class="op">=</span> [col.replace(<span class="st">"-"</span>, <span class="st">""</span>) <span class="cf">for</span> col <span class="kw">in</span> ff5_df.columns]</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>ff5_df.index.name <span class="op">=</span> <span class="st">"date"</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>ff5_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">MktRF</th>
<th data-quarto-table-cell-role="th">SMB</th>
<th data-quarto-table-cell-role="th">HML</th>
<th data-quarto-table-cell-role="th">RMW</th>
<th data-quarto-table-cell-role="th">CMA</th>
<th data-quarto-table-cell-role="th">RF</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1963-07-01</td>
<td>-0.67</td>
<td>0.02</td>
<td>-0.35</td>
<td>0.03</td>
<td>0.13</td>
<td>0.012</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1963-07-02</td>
<td>0.79</td>
<td>-0.28</td>
<td>0.28</td>
<td>-0.08</td>
<td>-0.21</td>
<td>0.012</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1963-07-03</td>
<td>0.63</td>
<td>-0.18</td>
<td>-0.10</td>
<td>0.13</td>
<td>-0.25</td>
<td>0.012</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1963-07-05</td>
<td>0.40</td>
<td>0.09</td>
<td>-0.28</td>
<td>0.07</td>
<td>-0.30</td>
<td>0.012</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1963-07-08</td>
<td>-0.63</td>
<td>0.07</td>
<td>-0.20</td>
<td>-0.27</td>
<td>0.06</td>
<td>0.012</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-12-22</td>
<td>0.21</td>
<td>0.61</td>
<td>0.09</td>
<td>-0.64</td>
<td>0.19</td>
<td>0.021</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023-12-26</td>
<td>0.48</td>
<td>0.81</td>
<td>0.46</td>
<td>-0.34</td>
<td>-0.15</td>
<td>0.021</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-12-27</td>
<td>0.16</td>
<td>0.16</td>
<td>0.12</td>
<td>-0.31</td>
<td>-0.14</td>
<td>0.021</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023-12-28</td>
<td>-0.01</td>
<td>-0.38</td>
<td>0.03</td>
<td>-0.32</td>
<td>0.15</td>
<td>0.021</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-12-29</td>
<td>-0.43</td>
<td>-1.13</td>
<td>-0.37</td>
<td>0.67</td>
<td>-0.07</td>
<td>0.021</td>
</tr>
</tbody>
</table>

<p>15229 rows × 6 columns</p>
</div>
</div>
</div>
<p>Finally, I join the two data sets to create a single data set with the following columns:</p>
<div id="cell-10" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[[<span class="st">"portLS"</span>]].join(ff5_df[[<span class="st">"MktRF"</span>, <span class="st">"SMB"</span>, <span class="st">"HML"</span>, <span class="st">"RMW"</span>, <span class="st">"CMA"</span>]], how<span class="op">=</span><span class="st">"inner"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">portLS</th>
<th data-quarto-table-cell-role="th">MktRF</th>
<th data-quarto-table-cell-role="th">SMB</th>
<th data-quarto-table-cell-role="th">HML</th>
<th data-quarto-table-cell-role="th">RMW</th>
<th data-quarto-table-cell-role="th">CMA</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1963-07-01</td>
<td>0.127573</td>
<td>-0.67</td>
<td>0.02</td>
<td>-0.35</td>
<td>0.03</td>
<td>0.13</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1963-07-02</td>
<td>0.680630</td>
<td>0.79</td>
<td>-0.28</td>
<td>0.28</td>
<td>-0.08</td>
<td>-0.21</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1963-07-03</td>
<td>0.184325</td>
<td>0.63</td>
<td>-0.18</td>
<td>-0.10</td>
<td>0.13</td>
<td>-0.25</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1963-07-05</td>
<td>0.304217</td>
<td>0.40</td>
<td>0.09</td>
<td>-0.28</td>
<td>0.07</td>
<td>-0.30</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1963-07-08</td>
<td>-0.216363</td>
<td>-0.63</td>
<td>0.07</td>
<td>-0.20</td>
<td>-0.27</td>
<td>0.06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022-12-23</td>
<td>2.926779</td>
<td>0.51</td>
<td>-0.34</td>
<td>1.16</td>
<td>0.86</td>
<td>0.46</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022-12-27</td>
<td>3.295579</td>
<td>-0.51</td>
<td>-0.44</td>
<td>1.42</td>
<td>1.16</td>
<td>1.22</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022-12-28</td>
<td>-1.003018</td>
<td>-1.23</td>
<td>-0.30</td>
<td>-0.29</td>
<td>-0.96</td>
<td>-0.04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022-12-29</td>
<td>-5.410157</td>
<td>1.87</td>
<td>1.03</td>
<td>-1.07</td>
<td>-1.02</td>
<td>-0.82</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022-12-30</td>
<td>-0.610269</td>
<td>-0.22</td>
<td>0.14</td>
<td>-0.03</td>
<td>-0.54</td>
<td>0.00</td>
</tr>
</tbody>
</table>

<p>14979 rows × 6 columns</p>
</div>
</div>
</div>
</section>
<section id="statsmodels" class="level2">
<h2 class="anchored" data-anchor-id="statsmodels">statsmodels</h2>
<p>The <a href="https://www.statsmodels.org/stable/index.html">statsmodels</a> library is a Python package that provides many functions for estimating statistical models and conducting statistical tests.</p>
<section id="installation" class="level3">
<h3 class="anchored" data-anchor-id="installation">Installation</h3>
<p>You can install the library with your package manager of choice:</p>
<p><strong>poetry</strong>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">poetry</span> add statsmodels</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>pip</strong>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install statsmodels</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>conda</strong>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> install statsmodels</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="usage" class="level3">
<h3 class="anchored" data-anchor-id="usage">Usage</h3>
<p>The library is easy to use for anyone familiar with the models used. However, reference to the <a href="https://www.statsmodels.org/stable/user-guide.html">documentation</a> is a must to understand how to use all the available options. In this post, I will use the linear regression model estimated by ordinary least squares (OLS). Statmodels provides two APIs: their <em>usual</em><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> API and the formula API that allows you to specify the model using a formula string similar to R. I will use the formula API in this post. The two APIs are imported as follows:</p>
<div id="cell-12" class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You define model a model by passing a string with the formula and a pandas DataFrame with the data to the <code>from_formula</code> method of the model class. For example, to create our OLS model that regresses the momentum strategy on the Fama-French 5 factors, we use the following code:</p>
<div id="cell-15" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>mod <span class="op">=</span> smf.ols(<span class="st">"portLS ~ MktRF + SMB + HML + RMW + CMA"</span>, data<span class="op">=</span>df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="ols-coefficients-and-standard-errors" class="level2">
<h2 class="anchored" data-anchor-id="ols-coefficients-and-standard-errors">OLS coefficients and standard errors</h2>
<p>The first model I estimate is a vanilla OLS model. In our example with the momentum strategy, the <span class="math inline">\(\beta\)</span> vector is <span class="math inline">\([ \alpha\ \beta_{MktRF}\ \beta_{SMB}\ \beta_{HML}\ \beta_{RMW}\ \beta_{CMA}]'\)</span>.</p>
<p>The OLS estimator is the most common in finance research. It is also the most efficient estimator when the errors are homoskedastic and uncorrelated across time. The OLS estimator is defined as:</p>
<p><span class="math display">\[
\hat{\beta}_{OLS} = (\mathbf{X}'\mathbf{X})^{-1}\mathbf{X}'\mathbf{y},
\]</span></p>
<p>where <span class="math inline">\(\mathbf{X}\)</span> is the matrix of exogenous variables and <span class="math inline">\(\mathbf{y}\)</span> is the vector of dependent variables. The covariance matrix <span class="math inline">\(\Sigma\)</span> of the estimator is defined as:</p>
<p><span class="math display">\[
\Sigma_{OLS}  =\sigma_{\mathbf{\epsilon}}^{2}\cdot\left(\mathbf{X}^{\prime}\mathbf{X}\right)^{-1},
\]</span></p>
<p>where <span class="math inline">\(\sigma_{\mathbf{\epsilon}}^{2}\)</span> is usually estimated with the residuals <span class="math inline">\(\mathbf{\hat{e}}=( \mathbf{y}-\mathbf{X}\hat{\beta}_{OLS})\)</span> from the OLS regression:</p>
<p><span class="math display">\[
\hat{\sigma}_{\mathbf{\epsilon}}^{2} =\frac{1}{N-K}\mathbf{\hat{e}}'\mathbf{\hat{e}}.
\]</span></p>
<p>The estimate of the covariance matrix is then:</p>
<p><span class="math display">\[
\hat{\Sigma}_{OLS}  =\frac{1}{N-K}\mathbf{\hat{e}}'\mathbf{\hat{e}}\cdot\left(\mathbf{X}^{\prime}\mathbf{X}\right)^{-1},
\]</span></p>
<p><span class="math display">\[
\hat{\Sigma}_{OLS}  =\left[\begin{array}{ccccc}
\hat{\sigma}_{\beta_1}^2 &amp; \hat{\sigma}_{\beta_1,\beta_2} &amp; \cdots &amp; \hat{\sigma}_{\beta_1,\beta_{K-1}} &amp; \hat{\sigma}_{\beta_1,\beta_K} \\
\hat{\sigma}_{\beta_2,\beta_1} &amp; \hat{\sigma}_{\beta_2}^2 &amp; \cdots &amp; \hat{\sigma}_{\beta_2,\beta_{K-1}} &amp; \hat{\sigma}_{\beta_2,\beta_K} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \vdots \\
\hat{\sigma}_{\beta_{K-1},\beta_1} &amp; \hat{\sigma}_{\beta_{K-1},\beta_2} &amp; \cdots &amp; \hat{\sigma}_{\beta_{K-1}}^2 &amp; \hat{\sigma}_{\beta_{K-1},\beta_K} \\
\hat{\sigma}_{\beta_K,\beta_1} &amp; \hat{\sigma}_{\beta_K,\beta_2} &amp; \cdots &amp; \hat{\sigma}_{\beta_K,\beta_{K-1}} &amp; \hat{\sigma}_{\beta_K}^2
\end{array} \right].
\]</span></p>
<p>To estimate the OLS model with statsmodels, we call the <code>fit()</code> method. The <code>fit()</code> method returns a regression results object, which contains the estimated coefficients, standard errors, and other statistics. The results object has a <code>summary()</code> Depending on the parameters passed to the <code>fit()</code> method, we can get z-statistics or t-statistics. I always use the <code>use_t=True</code> option to make sure I get t-statistics in the summary table.</p>
<div id="cell-18" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>mod.fit(use_t<span class="op">=</span><span class="va">True</span>).summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<table class="simpletable caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>OLS Regression Results</caption>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Dep. Variable:</td>
<td>portLS</td>
<td data-quarto-table-cell-role="th">R-squared:</td>
<td>0.128</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Model:</td>
<td>OLS</td>
<td data-quarto-table-cell-role="th">Adj. R-squared:</td>
<td>0.128</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Method:</td>
<td>Least Squares</td>
<td data-quarto-table-cell-role="th">F-statistic:</td>
<td>439.1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Date:</td>
<td>Thu, 01 Feb 2024</td>
<td data-quarto-table-cell-role="th">Prob (F-statistic):</td>
<td>0.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Time:</td>
<td>05:38:44</td>
<td data-quarto-table-cell-role="th">Log-Likelihood:</td>
<td>-26910.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">No. Observations:</td>
<td>14979</td>
<td data-quarto-table-cell-role="th">AIC:</td>
<td>5.383e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Df Residuals:</td>
<td>14973</td>
<td data-quarto-table-cell-role="th">BIC:</td>
<td>5.388e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Df Model:</td>
<td>5</td>
<td data-quarto-table-cell-role="th"></td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Covariance Type:</td>
<td>nonrobust</td>
<td data-quarto-table-cell-role="th"></td>
<td></td>
</tr>
</tbody>
</table>
<table class="simpletable caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td></td>
<td data-quarto-table-cell-role="th">coef</td>
<td data-quarto-table-cell-role="th">std err</td>
<td data-quarto-table-cell-role="th">t</td>
<td data-quarto-table-cell-role="th">P&gt;|t|</td>
<td data-quarto-table-cell-role="th">[0.025</td>
<td data-quarto-table-cell-role="th">0.975]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Intercept</td>
<td>0.0928</td>
<td>0.012</td>
<td>7.767</td>
<td>0.000</td>
<td>0.069</td>
<td>0.116</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">MktRF</td>
<td>-0.0635</td>
<td>0.013</td>
<td>-4.980</td>
<td>0.000</td>
<td>-0.089</td>
<td>-0.039</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">SMB</td>
<td>-0.2919</td>
<td>0.023</td>
<td>-12.510</td>
<td>0.000</td>
<td>-0.338</td>
<td>-0.246</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">HML</td>
<td>-0.9909</td>
<td>0.025</td>
<td>-39.510</td>
<td>0.000</td>
<td>-1.040</td>
<td>-0.942</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">RMW</td>
<td>0.3269</td>
<td>0.032</td>
<td>10.179</td>
<td>0.000</td>
<td>0.264</td>
<td>0.390</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">CMA</td>
<td>0.6359</td>
<td>0.040</td>
<td>15.712</td>
<td>0.000</td>
<td>0.557</td>
<td>0.715</td>
</tr>
</tbody>
</table>
<table class="simpletable caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Omnibus:</td>
<td>2945.727</td>
<td data-quarto-table-cell-role="th">Durbin-Watson:</td>
<td>1.724</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Prob(Omnibus):</td>
<td>0.000</td>
<td data-quarto-table-cell-role="th">Jarque-Bera (JB):</td>
<td>43704.781</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Skew:</td>
<td>-0.523</td>
<td data-quarto-table-cell-role="th">Prob(JB):</td>
<td>0.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Kurtosis:</td>
<td>11.302</td>
<td data-quarto-table-cell-role="th">Cond. No.</td>
<td>3.84</td>
</tr>
</tbody>
</table>
<br><br>Notes:<br>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</div>
</div>
</section>
<section id="white-standard-errors" class="level2">
<h2 class="anchored" data-anchor-id="white-standard-errors">White standard errors</h2>
<p>With time series data, the errors are often heteroskedastic and correlated across time. In this case, the OLS standard errors are incorrect.</p>
<p>A common solution to the problem of heteroskedasticity, i.e.&nbsp;that the variance of the error term is not constant, is to use heteroskedasticity-robust standard errors. The most common heteroskedasticity-robust standard errors estimator is the <span class="citation" data-cites="white1980heteroskedasticity">White (<a href="#ref-white1980heteroskedasticity" role="doc-biblioref">1980</a>)</span> estimator, which is defined as</p>
<p><span class="math display">\[
\hat{\Sigma}_{White} = (\mathbf{X}' \mathbf{X})^{-1}\cdot\left[\mathbf{X}' \cdot \hat{\Omega}_0  \cdot \mathbf{X}\right] \cdot\left(\mathbf{X}' \mathbf{X}\right)^{-1},
\]</span></p>
<p>where <span class="math inline">\(\hat{\Omega}_0\)</span> is a diagonal matrix with the squared residuals <span class="math inline">\(\mathbf{\hat{e}}^{2}\)</span> on the diagonal, i.e., with the square of the j-th residual <span class="math inline">\(\hat{e}_{j}^{2}\)</span> at position <span class="math inline">\((j,j)\)</span> and <span class="math inline">\(0\)</span> elsewhere. The matrix <span class="math inline">\(\hat{\Omega}_0\)</span> is defined as:</p>
<p><span class="math display">\[
\hat{\Omega}_0= \left[\begin{array}{cccccccc}
\hat{e}_{1}^{2} &amp; 0 &amp;  \cdots &amp; 0 &amp; 0 \\
0 &amp; \hat{e}_{2}^{2} &amp;  \cdots &amp; 0 &amp; 0\\
\vdots &amp; \vdots &amp; \ddots  &amp; \vdots &amp; \vdots\\
0 &amp; 0 &amp;  \cdots &amp; \hat{e}_{T-1}^{2} &amp; 0 \\
0 &amp; 0 &amp;  \cdots &amp; 0 &amp; \hat{e}_{T}^{2}
\end{array} \right].
\]</span></p>
<p>This is referred to as the <code>HC0</code> estimator in statsmodels. <span class="citation" data-cites="mackinnon1985some">MacKinnon and White (<a href="#ref-mackinnon1985some" role="doc-biblioref">1985</a>)</span> introduced three new estimators, <code>HC1</code>, <code>HC2</code>, and <code>HC3</code>, which are also available in statsmodels. The <code>HC1</code> estimator is the same as the <code>HC0</code> estimator with <span class="math inline">\(\hat{\Omega}_0\)</span> normalized by a factor of <span class="math inline">\(T/(T-K)\)</span> to make the estimator unbiased, where <span class="math inline">\(T\)</span> is the number of observations and <span class="math inline">\(K\)</span> is the number of independent variables.</p>
<p>The <code>ols</code> model we created can be used to estimate OLS models with White standard errors. The following code estimates the OLS coefficients and White standard errors:</p>
<div id="cell-20" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>mod.fit(cov_type<span class="op">=</span><span class="st">"HC0"</span>, use_t<span class="op">=</span><span class="va">True</span>).summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<table class="simpletable caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>OLS Regression Results</caption>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Dep. Variable:</td>
<td>portLS</td>
<td data-quarto-table-cell-role="th">R-squared:</td>
<td>0.128</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Model:</td>
<td>OLS</td>
<td data-quarto-table-cell-role="th">Adj. R-squared:</td>
<td>0.128</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Method:</td>
<td>Least Squares</td>
<td data-quarto-table-cell-role="th">F-statistic:</td>
<td>94.22</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Date:</td>
<td>Thu, 01 Feb 2024</td>
<td data-quarto-table-cell-role="th">Prob (F-statistic):</td>
<td>4.93e-98</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Time:</td>
<td>05:38:28</td>
<td data-quarto-table-cell-role="th">Log-Likelihood:</td>
<td>-26910.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">No. Observations:</td>
<td>14979</td>
<td data-quarto-table-cell-role="th">AIC:</td>
<td>5.383e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Df Residuals:</td>
<td>14973</td>
<td data-quarto-table-cell-role="th">BIC:</td>
<td>5.388e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Df Model:</td>
<td>5</td>
<td data-quarto-table-cell-role="th"></td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Covariance Type:</td>
<td>HC0</td>
<td data-quarto-table-cell-role="th"></td>
<td></td>
</tr>
</tbody>
</table>
<table class="simpletable caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td></td>
<td data-quarto-table-cell-role="th">coef</td>
<td data-quarto-table-cell-role="th">std err</td>
<td data-quarto-table-cell-role="th">t</td>
<td data-quarto-table-cell-role="th">P&gt;|t|</td>
<td data-quarto-table-cell-role="th">[0.025</td>
<td data-quarto-table-cell-role="th">0.975]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Intercept</td>
<td>0.0928</td>
<td>0.012</td>
<td>7.675</td>
<td>0.000</td>
<td>0.069</td>
<td>0.117</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">MktRF</td>
<td>-0.0635</td>
<td>0.020</td>
<td>-3.168</td>
<td>0.002</td>
<td>-0.103</td>
<td>-0.024</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">SMB</td>
<td>-0.2919</td>
<td>0.038</td>
<td>-7.741</td>
<td>0.000</td>
<td>-0.366</td>
<td>-0.218</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">HML</td>
<td>-0.9909</td>
<td>0.056</td>
<td>-17.570</td>
<td>0.000</td>
<td>-1.101</td>
<td>-0.880</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">RMW</td>
<td>0.3269</td>
<td>0.069</td>
<td>4.724</td>
<td>0.000</td>
<td>0.191</td>
<td>0.463</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">CMA</td>
<td>0.6359</td>
<td>0.081</td>
<td>7.820</td>
<td>0.000</td>
<td>0.477</td>
<td>0.795</td>
</tr>
</tbody>
</table>
<table class="simpletable caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Omnibus:</td>
<td>2945.727</td>
<td data-quarto-table-cell-role="th">Durbin-Watson:</td>
<td>1.724</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Prob(Omnibus):</td>
<td>0.000</td>
<td data-quarto-table-cell-role="th">Jarque-Bera (JB):</td>
<td>43704.781</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Skew:</td>
<td>-0.523</td>
<td data-quarto-table-cell-role="th">Prob(JB):</td>
<td>0.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Kurtosis:</td>
<td>11.302</td>
<td data-quarto-table-cell-role="th">Cond. No.</td>
<td>3.84</td>
</tr>
</tbody>
</table>
<br><br>Notes:<br>[1] Standard Errors are heteroscedasticity robust (HC0)
</div>
</div>
<p>The estimated coefficients are the same as with the OLS standard errors, but the standard errors are different. In turn, all statistical measures that depend on the standard errors, such as t-statistics and p-values, are different.</p>
</section>
<section id="newey-west-standard-errors" class="level2">
<h2 class="anchored" data-anchor-id="newey-west-standard-errors">Newey-West standard errors</h2>
<p>The White estimator takes into account only heteroskedasticity, but not autocorrelation. For that, we can use a hetoroskedasticity and autocorrelation robust (HAR)<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> standard errors estimator.</p>
<p>In empirical finance research, it is common in practice to use <a href="https://en.wikipedia.org/wiki/Newey%E2%80%93West_estimator">Newey-West</a> standard errors <span class="citation" data-cites="newey1987simple">(introduced in <a href="#ref-newey1987simple" role="doc-biblioref">Newey and West 1987</a>)</span> to account for both heteroskedasticity and autocorrelation. The Newey-West estimator is defined as:</p>
<p><span class="math display">\[
\hat{\Sigma}_{NW} = (\mathbf{X}' \mathbf{X})^{-1}\cdot \hat{S}_{HAR} \cdot\left(\mathbf{X}' \mathbf{X}\right)^{-1},
\]</span></p>
<p>where <span class="math inline">\(\hat{S}_{HAR}\)</span> is a matrix that takes into account both heteroskedasticity and autocorrelation:</p>
<p><span class="math display">\[
\hat{S}_{HAR} = \left[\mathbf{X}' \cdot \hat{\Omega}_0  \cdot \mathbf{X}\right] +\sum_{j=1}^{l}\omega(j,l)  \cdot\sum_{t=j+1}^{T}\left(
x_{t}\hat{e}_{t}\hat{e}_{t-j}x_{t-j}^{\prime}+x_{t-j}\hat{e}%
_{t-j}\hat{e}_{t}x_{t}^{\prime}\right),
\]</span></p>
<p>where <span class="math inline">\(\hat{e}_{i}\)</span> is the <span class="math inline">\(i\)</span>-th element of the vector <span class="math inline">\(\mathbf{\hat{e}}\)</span>. The matrix <span class="math inline">\(\hat{S}_{HAR}\)</span> is a weighted sum of the autocovariances of the residuals <span class="math inline">\(\mathbf{\hat{e}}\)</span>, where the kernel <span class="math inline">\(\omega(j,l)\)</span> provides the weight for lag <span class="math inline">\(j\)</span> with a bandwith (maximum lag) of <span class="math inline">\(l\)</span>. The Newey-West estimator uses a Bartlett kernel, which is defined as:</p>
<p><span class="math display">\[
\omega(j,l) = \left\{ \begin{array}{ll}
1 - \frac{|j|}{l+1} &amp; \text{if } |j| \leq l \\
0 &amp; \text{if } |j| &gt; l
\end{array} \right.
\]</span></p>
<p>The truncated uniform kernel used by <span class="citation" data-cites="hansen1980forward">Hansen and Hodrick (<a href="#ref-hansen1980forward" role="doc-biblioref">1980</a>)</span> is also available in statsmodels.</p>
<p>To use Newey-West standard errors, you pass the following arguments to the <code>fit()</code> method:</p>
<ul>
<li><code>cov_type="HAC"</code>: To use HAC standard errors. See the <a href="https://www.statsmodels.org/stable/generated/statsmodels.regression.linear_model.OLSResults.get_robustcov_results.html#statsmodels-regression-linear-model-olsresults-get-robustcov-results">documentation on Kernel (HAC)</a> for more details.</li>
<li><code>cov_kwds={"kernel": "bartlett", "maxlags": 5}</code>: A dictionary with the kernel and the number of lags to use (<code>maxlags</code>). Use the <code>uniform</code> kernel for the truncated uniform kernel of <span class="citation" data-cites="hansen1980forward">Hansen and Hodrick (<a href="#ref-hansen1980forward" role="doc-biblioref">1980</a>)</span>.</li>
</ul>
<div id="cell-24" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>mod.fit(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    cov_type<span class="op">=</span><span class="st">"HAC"</span>, cov_kwds<span class="op">=</span>{<span class="st">"kernel"</span>: <span class="st">"bartlett"</span>, <span class="st">"maxlags"</span>: <span class="dv">5</span>}, use_t<span class="op">=</span><span class="va">True</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>).summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<table class="simpletable caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>OLS Regression Results</caption>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Dep. Variable:</td>
<td>portLS</td>
<td data-quarto-table-cell-role="th">R-squared:</td>
<td>0.128</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Model:</td>
<td>OLS</td>
<td data-quarto-table-cell-role="th">Adj. R-squared:</td>
<td>0.128</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Method:</td>
<td>Least Squares</td>
<td data-quarto-table-cell-role="th">F-statistic:</td>
<td>58.10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Date:</td>
<td>Thu, 01 Feb 2024</td>
<td data-quarto-table-cell-role="th">Prob (F-statistic):</td>
<td>4.28e-60</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Time:</td>
<td>05:38:28</td>
<td data-quarto-table-cell-role="th">Log-Likelihood:</td>
<td>-26910.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">No. Observations:</td>
<td>14979</td>
<td data-quarto-table-cell-role="th">AIC:</td>
<td>5.383e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Df Residuals:</td>
<td>14973</td>
<td data-quarto-table-cell-role="th">BIC:</td>
<td>5.388e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Df Model:</td>
<td>5</td>
<td data-quarto-table-cell-role="th"></td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Covariance Type:</td>
<td>HAC</td>
<td data-quarto-table-cell-role="th"></td>
<td></td>
</tr>
</tbody>
</table>
<table class="simpletable caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td></td>
<td data-quarto-table-cell-role="th">coef</td>
<td data-quarto-table-cell-role="th">std err</td>
<td data-quarto-table-cell-role="th">t</td>
<td data-quarto-table-cell-role="th">P&gt;|t|</td>
<td data-quarto-table-cell-role="th">[0.025</td>
<td data-quarto-table-cell-role="th">0.975]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Intercept</td>
<td>0.0928</td>
<td>0.014</td>
<td>6.837</td>
<td>0.000</td>
<td>0.066</td>
<td>0.119</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">MktRF</td>
<td>-0.0635</td>
<td>0.025</td>
<td>-2.532</td>
<td>0.011</td>
<td>-0.113</td>
<td>-0.014</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">SMB</td>
<td>-0.2919</td>
<td>0.047</td>
<td>-6.275</td>
<td>0.000</td>
<td>-0.383</td>
<td>-0.201</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">HML</td>
<td>-0.9909</td>
<td>0.073</td>
<td>-13.596</td>
<td>0.000</td>
<td>-1.134</td>
<td>-0.848</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">RMW</td>
<td>0.3269</td>
<td>0.100</td>
<td>3.261</td>
<td>0.001</td>
<td>0.130</td>
<td>0.523</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">CMA</td>
<td>0.6359</td>
<td>0.103</td>
<td>6.191</td>
<td>0.000</td>
<td>0.435</td>
<td>0.837</td>
</tr>
</tbody>
</table>
<table class="simpletable caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Omnibus:</td>
<td>2945.727</td>
<td data-quarto-table-cell-role="th">Durbin-Watson:</td>
<td>1.724</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Prob(Omnibus):</td>
<td>0.000</td>
<td data-quarto-table-cell-role="th">Jarque-Bera (JB):</td>
<td>43704.781</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Skew:</td>
<td>-0.523</td>
<td data-quarto-table-cell-role="th">Prob(JB):</td>
<td>0.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Kurtosis:</td>
<td>11.302</td>
<td data-quarto-table-cell-role="th">Cond. No.</td>
<td>3.84</td>
</tr>
</tbody>
</table>
<br><br>Notes:<br>[1] Standard Errors are heteroscedasticity and autocorrelation robust (HAC) using 5 lags and without small sample correction
</div>
</div>
</section>
<section id="cheat-sheet" class="level2">
<h2 class="anchored" data-anchor-id="cheat-sheet">Cheat sheet</h2>
<p>The following table summarizes the standard errors estimators in statsmodels and their corresponding methods:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import the formula API</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define OLS model</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>mod <span class="op">=</span> smf.ols(<span class="st">"portLS ~ MktRF + SMB + HML + RMW + CMA"</span>, data<span class="op">=</span>df)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate OLS model with OLS standard errors</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> mod.fit(use_t<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate OLS model with White standard errors</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> mod.fit(cov_type<span class="op">=</span><span class="st">"HC0"</span>, use_t<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate OLS model with Newey-West standard errors</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> mod.fit(</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    cov_type<span class="op">=</span><span class="st">"HAC"</span>, cov_kwds<span class="op">=</span>{<span class="st">"kernel"</span>: <span class="st">"bartlett"</span>, <span class="st">"maxlags"</span>: <span class="dv">5</span>}, use_t<span class="op">=</span><span class="va">True</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate OLS model with Hansen-Hodrick standard errors</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> mod.fit(</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    cov_type<span class="op">=</span><span class="st">"HAC"</span>, cov_kwds<span class="op">=</span>{<span class="st">"kernel"</span>: <span class="st">"uniform"</span>, <span class="st">"maxlags"</span>: <span class="dv">5</span>}, use_t<span class="op">=</span><span class="va">True</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="learn-more" class="level2">
<h2 class="anchored" data-anchor-id="learn-more">Learn more</h2>
<p>To learn more about the statsmodels library, I recommend reading the <a href="https://www.statsmodels.org/stable/index.html">documentation</a>, especially the section on <a href="https://www.statsmodels.org/stable/regression.html">linear regression</a>.</p>
<p>Using widely-used software tools like statsmodels is a good way to make your research more reproducible and transparent. However, like any tool, it is important to understand the underlying econometric theory. If you are interested in learning more about the standard errors discussed in this post, I recommend reading <span class="citation" data-cites="white1980heteroskedasticity">White (<a href="#ref-white1980heteroskedasticity" role="doc-biblioref">1980</a>)</span>, <span class="citation" data-cites="newey1987simple">Newey and West (<a href="#ref-newey1987simple" role="doc-biblioref">1987</a>)</span>, <span class="citation" data-cites="mackinnon1985some">MacKinnon and White (<a href="#ref-mackinnon1985some" role="doc-biblioref">1985</a>)</span>, and <span class="citation" data-cites="hansen1980forward">Hansen and Hodrick (<a href="#ref-hansen1980forward" role="doc-biblioref">1980</a>)</span>.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-ChenZimmermann2021" class="csl-entry" role="listitem">
Chen, Andrew Y., and Tom Zimmermann. 2022. <span>“Open Source Cross-Sectional Asset Pricing.”</span> <em>Critical Finance Review</em> 27 (2): 207–64. <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3604626">https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3604626</a>.
</div>
<div id="ref-hansen1980forward" class="csl-entry" role="listitem">
Hansen, Lars Peter, and Robert J Hodrick. 1980. <span>“Forward Exchange Rates as Optimal Predictors of Future Spot Rates: An Econometric Analysis.”</span> <em>Journal of Political Economy</em> 88 (5): 829–53. <a href="https://www.journals.uchicago.edu/doi/abs/10.1086/260910">https://www.journals.uchicago.edu/doi/abs/10.1086/260910</a>.
</div>
<div id="ref-mackinnon1985some" class="csl-entry" role="listitem">
MacKinnon, James G, and Halbert White. 1985. <span>“Some Heteroskedasticity-Consistent Covariance Matrix Estimators with Improved Finite Sample Properties.”</span> <em>Journal of Econometrics</em> 29 (3): 305–25. <a href="https://doi.org/10.1016/0304-4076(85)90158-7">https://doi.org/10.1016/0304-4076(85)90158-7</a>.
</div>
<div id="ref-newey1987simple" class="csl-entry" role="listitem">
Newey, Whitney K, and Kenneth D West. 1987. <span>“A Simple, Positive Semi-Definite, Heteroskedasticity and Autocorrelation Consistent Covariance Matrix.”</span> <em>Econometrica</em> 55 (3): 703–8. <a href="https://www.jstor.org/stable/1913610">https://www.jstor.org/stable/1913610</a>.
</div>
<div id="ref-white1980heteroskedasticity" class="csl-entry" role="listitem">
White, Halbert. 1980. <span>“A Heteroskedasticity-Consistent Covariance Matrix Estimator and a Direct Test for Heteroskedasticity.”</span> <em>Econometrica</em>, 817–38. <a href="https://doi.org/10.2307/1912934">https://doi.org/10.2307/1912934</a>.
</div>
</div>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>This is how it is called in the <a href="https://www.statsmodels.org/dev/example_formulas.html">documentation</a>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Also called heteroskedasticity and autocorrelation consistent (HAC) standard errors.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/vincent\.codes\.finance");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2024, Vincent Grégoire</p>
</div>   
    <div class="nav-footer-center">

<div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>